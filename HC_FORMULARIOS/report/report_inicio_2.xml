<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="report_inicio_2_documento">
    <t t-foreach="docs" t-as="doc">
      <div class="page" style="padding: 15px; font-family: Arial, sans-serif; font-size: 12px;">

        <!-- SECCIÓN E. ANTECEDENTES FAMILIARES -->
        <h3 style="background-color: #dcdcf9; padding: 5px; font-size: 14px; text-transform: uppercase; font-weight: bold;">
          E. ANTECEDENTES FAMILIARES (DETALLAR EL PARENTESCO)
        </h3>
        <p style="text-align: right; font-size: 10px; font-weight: bold;">
          MARCAR Y DESCRIBIR ABAJO ANOTANDO EL NÚMERO
        </p>

        <table style="width: 100%; border-collapse: collapse; font-size: 11px; text-align: center;">
          <thead>
            <tr style="background-color: #ccffcc;">
              <th style="border: 1px solid #000;">1. ENFERMEDAD CARDIO-VASCULAR</th>
              <th style="border: 1px solid #000;">2. ENFERMEDAD METABÓLICA</th>
              <th style="border: 1px solid #000;">3. ENFERMEDAD NEUROLÓGICA</th>
              <th style="border: 1px solid #000;">4. ENFERMEDAD ONCOLÓGICA</th>
              <th style="border: 1px solid #000;">5. ENFERMEDAD INFECCIOSA</th>
              <th style="border: 1px solid #000;">6. ENFERMEDAD HEREDITARIA / CONGÉNITA</th>
              <th style="border: 1px solid #000;">7. DISCAPACIDADES</th>
              <th style="border: 1px solid #000;">8. OTROS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="border: 1px solid #000;"><t t-out="doc.enfermedad_cardio and 'X' or '-'"/></td>
              <td style="border: 1px solid #000;"><t t-out="doc.enfermedad_metabolidca and 'X' or '-'"/></td>
              <td style="border: 1px solid #000;"><t t-out="doc.enfermedad_neurologica and 'X' or '-'"/></td>
              <td style="border: 1px solid #000;"><t t-out="doc.enfermedad_oncologica and 'X' or '-'"/></td>
              <td style="border: 1px solid #000;"><t t-out="doc.enfermedad_infecciosa and 'X' or '-'"/></td>
              <td style="border: 1px solid #000;"><t t-out="doc.enfermedad_hereditaria and 'X' or '-'"/></td>
              <td style="border: 1px solid #000;"><t t-out="doc.discapacidad and 'X' or '-'"/></td>
              <td style="border: 1px solid #000;"><t t-out="doc.otra_enfermedad and 'X' or '-'"/></td>
            </tr>
          </tbody>
        </table>

        <!-- Descripción -->
        <p style="border: 1px solid #000; padding: 5px; margin-top: 4px; font-size: 11px;">
          <t t-out="doc.refiere or 'NO REFIERE'"/>
        </p>
       <h3 style="background-color: #dcdcf9; padding: 5px; font-size:14px; text-transform: uppercase; font-weight: bold;">
  F. FACTORES DE RIESGOS DEL PUESTO DE TRABAJO ACTUAL
</h3>

<t t-if="doc.riesgos_ids">
  <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; font-size: 10px;">
    <thead>
      <tr style="background-color: #ccffcc;">
        <th rowspan="2" style="border: 1px solid #000; padding: 4px;">PUESTO DE TRABAJO / ÁREA</th>
        <th rowspan="2" style="border: 1px solid #000; padding: 4px;">ACTIVIDADES</th>
        <th colspan="3" style="border: 1px solid #000; padding: 4px;">TIPO DE RIESGO</th>
      </tr>
      <tr style="background-color: #ccffcc;">
        <th style="border: 1px solid #000; padding: 4px;">FÍSICO</th>
        <th style="border: 1px solid #000; padding: 4px;">MECÁNICO</th>
        <th style="border: 1px solid #000; padding: 4px;">QUÍMICO</th>
      </tr>
    </thead>
    <tbody>
      <!-- Agrupamos por puesto -->
      <t t-set="puestos" t-value="set([r.puesto_id for r in doc.riesgos_ids if r.puesto_id])"/>
      <t t-foreach="puestos" t-as="puesto">
        <tr>
          <!-- PUESTO -->
          <td style="border: 1px solid #000; padding: 4px;"><t t-esc="puesto.name"/></td>

          <!-- ACTIVIDADES -->
          <td style="border: 1px solid #000; padding: 4px;">
            <t t-set="actividad" t-value="(doc.riesgos_ids.filtered(lambda r: r.puesto_id.id == puesto.id))[0].actividades"/>
            <t t-esc="actividad or ''"/>
          </td>

          <!-- FÍSICO -->
          <td style="border: 1px solid #000; padding: 4px;">
            <t t-foreach="doc.riesgos_ids.filtered(lambda r: r.puesto_id.id == puesto.id and r.typo_riesgos.name == 'FISICO')" t-as="r">
              <div><t t-esc="r.riesgo.name"/></div>
            </t>
          </td>

          <!-- MECÁNICO -->
          <td style="border: 1px solid #000; padding: 4px;">
            <t t-foreach="doc.riesgos_ids.filtered(lambda r: r.puesto_id.id == puesto.id and r.typo_riesgos.name == 'MECANICO')" t-as="r">
              <div><t t-esc="r.riesgo.name"/></div>
            </t>
          </td>

          <!-- QUÍMICO -->
          <td style="border: 1px solid #000; padding: 4px;">
            <t t-foreach="doc.riesgos_ids.filtered(lambda r: r.puesto_id.id == puesto.id and r.typo_riesgos.name == 'QUIMICO')" t-as="r">
              <div><t t-esc="r.riesgo.name"/></div>
            </t>
          </td>
        </tr>
      </t>
    </tbody>
  </table>
</t>

<br/>
<!-- PARTE 2 -->
<t t-if="doc.riesgos_ids_2">
  <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; font-size: 10px;">
    <thead>
      <tr style="background-color: #ccffcc;">
        <th rowspan="2" style="border: 1px solid #000; padding: 4px;">PUESTO DE TRABAJO / ÁREA</th>
        <th rowspan="2" style="border: 1px solid #000; padding: 4px;">ACTIVIDADES</th>
        <th colspan="3" style="border: 1px solid #000; padding: 4px;">TIPO DE RIESGO</th>
        <th rowspan="2" style="border: 1px solid #000; padding: 4px;">MEDIDAS PREVENTIVAS</th>
      </tr>
      <tr style="background-color: #ccffcc;">
        <th style="border: 1px solid #000; padding: 4px;">BIOLÓGICO</th>
        <th style="border: 1px solid #000; padding: 4px;">ERGONÓMICO</th>
        <th style="border: 1px solid #000; padding: 4px;">PSICOSOCIAL</th>
      </tr>
    </thead>
    <tbody>
      <t t-foreach="doc.riesgos_ids_2" t-as="line2">
        <tr>
          <!-- PUESTO -->
          <td style="border: 1px solid #000; padding: 4px;"><t t-esc="line2.puesto_id.name or ''"/></td>

          <!-- ACTIVIDADES -->
          <td style="border: 1px solid #000; padding: 4px;"><t t-esc="line2.actividades or ''"/></td>

          <!-- BIOLÓGICO -->
          <td style="border: 1px solid #000; padding: 4px; text-align: center;">
            <t t-if="line2.typo_riesgos.name == 'BIOLOGICO' and line2.riesgo">
              <t t-esc="line2.riesgo.name"/>
            </t>
          </td>

          <!-- ERGONÓMICO -->
          <td style="border: 1px solid #000; padding: 4px; text-align: center;">
            <t t-if="line2.typo_riesgos.name == 'ERGONOMICO' and line2.riesgo">
              <t t-esc="line2.riesgo.name"/>
            </t>
          </td>

          <!-- PSICOSOCIAL -->
          <td style="border: 1px solid #000; padding: 4px; text-align: center;">
            <t t-if="line2.typo_riesgos.name == 'PSICOSOCIAL' and line2.riesgo">
              <t t-esc="line2.riesgo.name"/>
            </t>
          </td>

          <!-- MEDIDAS PREVENTIVAS -->
          <td style="border: 1px solid #000; padding: 4px;"><t t-esc="line2.medidas_preventiva or ''"/></td>
        </tr>
      </t>
    </tbody>
  </table>
</t>

        <h3 style="background-color: #c9c9f9; padding: 6px; font-size: 13px; font-weight: bold; text-transform: uppercase; border: 1px solid #000;">
  G. ACTIVIDADES EXTRA LABORALES
</h3>

<table style="width: 100%; border: 1px solid #000; border-collapse: collapse; font-size: 11px;">
  <t t-if="doc.actividades_extras_laborales">
    <t t-foreach="doc.actividades_extras_laborales" t-as="actividad">
      <tr>
        <td style="border: 1px solid #000; padding: 8px;">
          <t t-esc="actividad.actividad or ''"/>
        </td>
      </tr>
    </t>
  </t>
  <t t-if="not doc.actividades_extras_laborales">
    <tr>
      <td style="border: 1px solid #000; padding: 8px;">NO REFIERE</td>
    </tr>
  </t>
  <tr>
    <td style="border: 1px solid #000; padding: 20px; text-align: center;">
      ______________________
    </td>
  </tr>
</table>
<h3 style="background-color: #c9c9f9; padding: 6px; font-size: 13px; font-weight: bold; text-transform: uppercase; border: 1px solid #000;">
  H. ENFERMEDAD ACTUAL
</h3>

<table style="width: 100%; border-collapse: collapse; font-size: 11px;">
  <tr>
    <td style="border: 1px solid #000; padding: 8px;">
      <t t-esc="doc.enfermedad_actual or 'PACIENTE ACUDE A VALORACIÓN MÉDICA OCUPACIONAL AL MOMENTO ASINTOMÁTICO EN CONDICIÓN ESTABLE, NIEGA PATOLOGÍAS EN LOS ÚLTIMOS TRES MESES'" />
    </td>
  </tr>
  <tr>
    <td style="border: 1px solid #000; padding: 20px; text-align: center;">
      ______________________
    </td>
  </tr>
</table>
<h3 style="background-color: #c9c9f9; padding: 6px; font-size: 13px; font-weight: bold; text-transform: uppercase; border: 1px solid #000;">
  I. REVISIÓN ACTUAL DE ÓRGANOS Y SISTEMAS
</h3>

<p style="font-size: 10px; font-weight: bold; text-align: right; margin-bottom: 2px;">
  EN CASO DE EXISTIR PATOLOGÍA MARCAR CON "X" Y DESCRIBIR ABAJO COLOCANDO EL NUMERAL
</p>

<table style="width: 100%; border-collapse: collapse; font-size: 11px; background-color: #d6faff;">
  <t t-set="organos_list" t-value="doc.organos_sistemas_ids" />
  <t t-set="max_rows" t-value="10" />
  <t t-set="numerados" t-value="[(i + 1, organo) for i, organo in enumerate(organos_list)]" />
  <t t-set="faltantes" t-value="max_rows - len(numerados)" />
  <t t-set="numerados" t-value="numerados + [(len(numerados) + i + 1, None) for i in range(faltantes)]" />

  <t t-foreach="range(0, len(numerados), 2)" t-as="i">
    <tr>
      <!-- Columna 1 -->
      <t t-set="item1" t-value="numerados[i]" />
      <td style="border: 1px solid #000; width: 25%;">
        <t t-if="item1[1]">
          <t t-esc="str(item1[0]) + '. ' + item1[1].organo_sistema_.name_organo_sistema" />
        </t>
        <t t-if="not item1[1]">
          <t t-esc="str(item1[0]) + '. '" />
        </t>
      </td>
      <td style="border: 1px solid #000; text-align: center; width: 5%;">
        <t t-if="item1[1] and item1[1].patologia">X</t>
        <t t-if="not item1[1] or not item1[1].patologia">–</t>
      </td>

      <!-- Columna 2 -->
      <t t-if="i + 1 &lt; len(numerados)">
        <t t-set="item2" t-value="numerados[i + 1]" />
        <td style="border: 1px solid #000; width: 25%;">
          <t t-if="item2[1]">
            <t t-esc="str(item2[0]) + '. ' + item2[1].organo_sistema_.name_organo_sistema" />
          </t>
          <t t-if="not item2[1]">
            <t t-esc="str(item2[0]) + '. '" />
          </t>
        </td>
        <td style="border: 1px solid #000; text-align: center; width: 5%;">
          <t t-if="item2[1] and item2[1].patologia">X</t>
          <t t-if="not item2[1] or not item2[1].patologia">–</t>
        </td>
      </t>
    </tr>
  </t>
</table>
<table style="width: 100%; border-collapse: collapse; font-size: 11px;">
  <tr>
    <td colspan="2" style="border: 1px solid #000; padding: 10px;">
      <t t-esc="doc.observacion_organos or 'SIN PATOLOGÍA APARENTE'" />
    </td>
  </tr>
  <tr>
    <td style="border: 1px solid #000; padding: 20px; text-align: center;">
      ____________________________
    </td>
    <td style="border: 1px solid #000; padding: 20px; text-align: center;">
      ___________________________
    </td>
  </tr>
</table>


<t t-set="imc_rojo" t-value="float(doc.indice_masa_corporal or 0) > 25"/>
<div style="margin-top: 20px;">
    <table style="width:100%; border-collapse:collapse; font-size:12px;">
        <thead>
            <tr style="background-color:#d7d3f0;">
                <th colspan="9" style="text-align:left; font-weight:bold; padding:4px;">
                    J. CONSTANTES VITALES Y ANTROPOMETRÍA
                </th>
            </tr>
            <tr style="background-color:#d9fdd3; text-align:center;">
                <th style="border:1px solid #000;">PRESIÓN ARTERIAL<br/>(mmHg)</th>
                <th style="border:1px solid #000;">TEMPERATURA<br/>(°C)</th>
                <th style="border:1px solid #000;">FRECUENCIA CARDIACA<br/>(Lat/min)</th>
                <th style="border:1px solid #000;">SATURACIÓN DE OXÍGENO<br/>(O2%)</th>
                <th style="border:1px solid #000;">FRECUENCIA RESPIRATORIA<br/>(fr/min)</th>
                <th style="border:1px solid #000;">PESO<br/>(Kg)</th>
                <th style="border:1px solid #000;">TALLA<br/>(cm)</th>
                <th style="border:1px solid #000;">ÍNDICE DE MASA CORPORAL<br/>(kg/m²)</th>
                <th style="border:1px solid #000;">PERÍMETRO ABDOMINAL<br/>(cm)</th>
            </tr>
        </thead>
        <tbody>
            <tr style="text-align:center;">
                <td style="border:1px solid #000;"><t t-esc="doc.presion_arterial"/></td>
                <td style="border:1px solid #000;"><t t-esc="doc.temperatura"/></td>
                <td style="border:1px solid #000;"><t t-esc="doc.frecuencia_cardiaca"/></td>
                <td style="border:1px solid #000;"><t t-esc="doc.saturacion_oxigeno"/></td>
                <td style="border:1px solid #000;"><t t-esc="doc.frecuencia_respiratoria"/></td>
                <td style="border:1px solid #000;"><t t-esc="doc.peso"/></td>
                <td style="border:1px solid #000;"><t t-esc="doc.talla"/></td>
                <td style="border:1px solid #000; color: red;" t-if="imc_rojo">
                    <t t-esc="doc.indice_masa_corporal"/>
                </td>
                <td style="border:1px solid #000;" t-if="not imc_rojo">
                    <t t-esc="doc.indice_masa_corporal"/>
                </td>
                <td style="border:1px solid #000;"><t t-esc="doc.perimetro_abdominal"/></td>
            </tr>
        </tbody>
    </table>
</div>


      </div>
    </t>
  </template>
</odoo>
